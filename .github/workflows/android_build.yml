name: Build Android APK

on:
  push:
    branches: [ "main", "master" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: 1. æ‹‰å–ä»£ç 
        uses: actions/checkout@v4

      - name: 2. è®¾ç½® Java ç¯å¢ƒ (å¿…é¡»æ˜¯ Java 8)
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '8'

      - name: 3. ğŸš‘ã€å…³é”®ä¿®å¤ã€‘æ¸…ç†ä¸å…¼å®¹çš„é«˜ç‰ˆæœ¬ Build Tools
        run: |
          echo "æ­£åœ¨æ¸…ç†å¯¼è‡´å´©æºƒçš„æ–°ç‰ˆ Build Tools..."
          # ä½ çš„è€é¡¹ç›®æ— æ³•è¯†åˆ« 30.0.0 ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œç›´æ¥åˆ æ‰å®ƒä»¬
          rm -rf $ANDROID_HOME/build-tools/34*
          rm -rf $ANDROID_HOME/build-tools/35*
          rm -rf $ANDROID_HOME/build-tools/36*
          echo "æ¸…ç†å®Œæˆï¼Œå‰©ä½™ç‰ˆæœ¬ï¼š"
          ls $ANDROID_HOME/build-tools/

      - name: 4. èµ‹äºˆ gradlew æ‰§è¡Œæƒé™
        run: chmod +x gradlew

      - name: 5. æ‰§è¡Œç¼–è¯‘å‘½ä»¤
        run: ./gradlew assembleDebug --stacktrace
        # åŠ ä¸Š --stacktrace å¯ä»¥è®©æˆ‘ä»¬åœ¨å‡ºé”™æ—¶çœ‹åˆ°æ›´è¯¦ç»†çš„ä¿¡æ¯

      - name: 6. ä¸Šä¼ ç”Ÿæˆçš„ APK
        uses: actions/upload-artifact@v4
        with:
          name: my-android-apk
          path: app/build/outputs/apk/debug/*.apk
